name: frontend-ci-cd
on:
  push:
    branches: [ main ]
    paths: [ "frontend/**", ".github/workflows/frontend.yml" ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: "20" }
      - name: Install & build
        working-directory: frontend
        env:
          VITE_API_BASE: https://cal-api.mon-site.ca
        run: |
          npm ci
          npm run build
      - name: rsync dist/ to server
        uses: burnett01/rsync-deployments@5.2.1
        with:
          switches: -avz --delete
          path: frontend/dist/
          remote_path: /var/www/cal.mon-site.ca/public_html/
          remote_host: ${{ secrets.SSH_HOST }}
          remote_user: ${{ secrets.SSH_USER }}
          remote_key: ${{ secrets.SSH_KEY }}
